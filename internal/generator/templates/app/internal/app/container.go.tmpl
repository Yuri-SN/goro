package app

import (
    {{if .Storages}}
        {{range .Storages -}}
            {{if eq .Type `mysqlx`}}"github.com/jmoiron/sqlx"{{end}}
            {{if eq .Type `mysql`}}"database/sql"{{end}}
        {{end -}}
    {{end}}

    {{if .Dependencies}}
        {{range .Dependencies -}}
            "{{ $.App.Module }}/{{.Pkg}}"
        {{end -}}
    {{end}}
)

type Container struct {
	{{if .Storages}}
		//goro:container databases
		{{range $key, $val := .Storages}}
    		{{$key}} {{$val.Connection}}
		{{end -}}
	{{end}}

	deps    map[string]interface{}
}

func NewContainer({{if .Storages}}{{range $key, $val := .Storages}}{{$key}} {{$val.Connection}},{{end -}}{{end}}) *Container {
	
    return &Container{
		{{if .Storages}}
            
            //goro:container databases
            {{range $key, $val := .Storages}}
                {{$key}}: {{$key}},
            {{end -}}
	    {{end}}
		deps:    make(map[string]interface{}),
	}
}

{{if .Dependencies}}
    {{range $key, $val := .Dependencies}}
        func (cnt *Container) Get{{toCamelCase $key.String }}() {{ $val.Type }} {
            
            return {{ $val.BuildFunc }} ({{range $p := $val.Deps}} cnt.{{$p}}, {{end}})
        }
    {{end}}
{{end}}